<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chameleon Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
         rel="stylesheet"
    />
    <style>
    /* Base reset */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    /* Full-height flex container */
    body {
    display: flex;
    flex-direction: column;
    align-items: center;         /* keep horizontal centering */
    justify-content: flex-start; /* align content to the top */
    min-height: 100vh;
    padding: 2rem 1rem 1rem;      /* top padding for breathing room */
    font-family: 'Roboto', sans-serif;
    background: #f7f7f7;
    color: #333;
    text-align: center;
    }

    h1 {
        font-size: 1.8rem;
        margin-bottom: 1rem;
    }

    /* Button styling */
    button {
        font-size: 1rem;
        padding: 0.75rem 1.5rem;
        margin: 0.5rem;
        border: none;
        border-radius: 4px;
        background-color: #4a90e2;
        color: white;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    button:hover {
        background-color: #357ab8;
    }

    /* Viewer info */
    #viewer-info {
        margin-bottom: 1.5rem;
    }

    #viewer-info span {
        font-weight: 500;
    }

    /* Word display */
    #word-display {
        font-size: 1.2rem;
        margin: 1rem 0;
        font-weight: 500;
    }

    /* Responsive tweaks */
    @media (max-width: 400px) {
        h1 { font-size: 1.5rem; }
        button { width: 100%; }
    }
    </style>

</head>
<body>  
    <h1>Welcome to Chameleon</h1>
    <div id="viewer-info">
        <strong>Players:</strong> <span id="count">0</span>
    </div>

    <button id="newgame-btn" class="btn btn-success">New Game</button>
    <div id="game-info" style="margin-top:1em">
        <p id="word-display"></p>
    </div>

    <script>
        // Poll for status every second
        async function poll() {
            // Fetch status
            const stat = await fetch('/status')
                .then(res => res.json());

            // Update only the viewer count
            document.getElementById('count').innerText = stat.count;

            // Fetch game state (unchanged)
            const gs = await fetch('/game_state').then(r => r.json());
            const display = document.getElementById('word-display');

            if (!gs.started) {
                display.innerText = 'Waiting to startâ€¦';
            } else if (gs.you_chameleon) {
                display.innerText = 'You are the Chameleon!';
            } else {
                display.innerText = gs.word;
            }
        }

        setInterval(poll, 1000);
        poll();

        // New Game button
        document.getElementById('newgame-btn').onclick = async () => {
            // First clear out any running game
            await fetch('/reset', { method: 'POST' });

            // Then immediately start a fresh one
            await fetch('/start', { method: 'POST' });

            // Optionally re-poll instantly so UI jumps right in
            poll();
        };
    </script>
    </body>
</html>